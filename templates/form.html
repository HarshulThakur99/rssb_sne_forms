<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bio Data Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* --- Styles for Navigation Alignment --- */
        nav {
            display: flex; /* Use Flexbox for alignment */
            align-items: center; /* Vertically center items */
            padding: 5px 10px; /* Adjust padding as needed, added horizontal padding */
            /* Ensure no background color is added here unless it was original */
        }

        .nav-logo {
             margin-right: 15px; /* Space after logo */
             /* Keep original logo size/styling */
             vertical-align: middle; /* Align logo nicely if needed */
             flex-shrink: 0; /* Prevent logo from shrinking */
        }

        /* Div for the center links */
        .nav-center-links {
            flex-grow: 1; /* Allows this div to take up available space */
            text-align: center; /* Centers the content (links) within the div */
        }

        .nav-center-links a { /* Target links within the center div */
            margin: 0 5px; /* Adjust spacing around links and separators */
            /* Keep original link color or set as needed */
            text-decoration: none;
        }
         .nav-center-links a:hover {
            text-decoration: underline;
         }

        /* This div will contain the welcome message and logout link */
        .nav-user-info-right {
            /* margin-left: auto; Removed as flex-grow on center handles spacing */
            display: inline-flex; /* Use inline-flex to keep items together */
            align-items: center; /* Vertically center items */
            flex-shrink: 0; /* Prevent user info from shrinking */
        }

        .nav-user-info-right span {
            color: white !important; /* Make welcome text white, !important if needed */
            margin-right: 5px; /* Space before the separator */
            margin-left: 5px; /* Space after the previous separator */
        }

        .nav-user-info-right a {
            /* Style logout link if needed, e.g., color: white; */
             margin-left: 5px; /* Space after the separator */
             text-decoration: none;
        }
        .nav-user-info-right a:hover {
             text-decoration: underline;
        }
        /* --- End Navigation Styles --- */


        /* Style for form sections (fieldsets) */
        .form-group {
            margin-bottom: 5px;
            padding: 0px;
            border: 0px solid #ddd;
            border-radius: 8px;
        }

        /* Style for legends within form groups */
        .form-group legend {
            margin-bottom: 10px !important;
            padding-bottom: 5px !important;
        }


        /* Style for rows within sections */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .form-row:last-child {
            margin-bottom: 0;
        }

        /* Style for individual form fields */
        .form-field {
            flex: 1; /* Allow fields to grow and shrink */
            margin-right: 15px;
            min-width: 150px; /* Minimum width before wrapping */
        }
        .form-field:last-child {
            margin-right: 0;
        }
         /* Reduce top margin for labels */
        .form-field label {
            margin-top: 5px;
            margin-bottom: 2px;
            display: block; /* Ensure labels are block elements */
        }
        /* Reduce top margin for inputs */
        .form-field input,
        .form-field select,
        .form-field textarea {
             margin-top: 2px;
             width: 100%; /* Make inputs take full width of their container */
             box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }
        /* Specific width for address textarea */
        .form-field.address-field textarea {
             /* Adjust flex-basis or width as needed */
             /* Example: Make address take up more space */
             flex-basis: 40%; /* Adjust percentage */
        }
         /* Specific width for state select */
        .form-field.state-field select {
             /* Example: Adjust width */
             flex-basis: 30%; /* Adjust percentage */
        }
         /* Specific width for pincode input */
        .form-field.pincode-field input {
             /* Example: Adjust width */
             flex-basis: 20%; /* Adjust percentage */
        }


        /* Specific style for rows with three items */
        .form-row-three-items .form-field {
            /* Default flex: 1 might work, or adjust flex-basis */
             flex-basis: calc(33.333% - 10px); /* Adjust if needed */
        }

         /* Style for radio button groups */
        .radio-group label {
            margin-right: 15px;
            display: inline-block;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column; /* Stack fields vertically */
            }
            .form-field {
                margin-right: 0;
                margin-bottom: 8px;
                width: 100%; /* Make fields take full width */
                flex-basis: auto !important; /* Override flex-basis on small screens */
            }
            .form-field:last-child {
                 margin-bottom: 0;
            }
            .form-row-three-items .form-field {
                flex-basis: 100%; /* Full width on small screens */
            }
             .radio-group label {
                display: block;
                margin-bottom: 5px;
            }
            /* Responsive Nav adjustments */
            nav {
                flex-wrap: wrap; /* Allow nav items to wrap on small screens */
                justify-content: center; /* Center items when wrapped */
            }
            .nav-center-links {
                 order: 2; /* Place center links below logo */
                 width: 100%; /* Full width */
                 margin-top: 5px;
                 text-align: center;
            }
            .nav-user-info-right {
                 order: 3; /* Place user info last */
                 width: 100%; /* Full width */
                 justify-content: center; /* Center user info */
                 margin-top: 5px; /* Add some space when wrapped */
            }
             .nav-logo {
                 order: 1; /* Keep logo first */
                 margin-right: 0; /* Remove right margin */
                 display: block; /* Ensure logo is block */
                 margin-left: auto; /* Center logo */
                 margin-right: auto; /* Center logo */
             }
        }

        /* Styling for required labels (optional, example) */
        .required::after {
            content: " *";
            color: red;
        }

        /* Basic styling for the submit button */
        button[type="submit"] {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        button[type="submit"]:hover {
            background-color: #0056b3;
        }

        /* Style for readonly fields */
        input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

    </style>
</head>
<body>

    <nav>
        <img src="{{ url_for('static', filename='images/rssb.jpg') }}" alt="Logo" class="nav-logo">

        {% if current_user.is_authenticated %}
            <div class="nav-center-links">
                <a href="{{ url_for('form') }}">Data Entry Form</a> |
                <a href="{{ url_for('printer') }}">Badge Printer</a>
            </div>
            <div class="nav-user-info-right">
                <span>Welcome, {{ current_user.id }}!</span> | <a href="{{ url_for('logout') }}">Logout</a>
            </div>
        {% else %}
            {# Optional: Add a login link or message #}
        {% endif %}
    </nav>
    <hr>

    <div class="container">
        <div class="header-section">
            <h1>Bio Data Form for Senior Citizen and Special Needs Sangat</h1>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="flash-messages">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}

        <form action="{{ url_for('submit_form') }}" method="post" enctype="multipart/form-data">

            <input type="hidden" name="submission_date" value="{{ today_date.strftime('%Y-%m-%d') }}">

            <fieldset class="form-group">
                <div class="form-row">
                    <div class="form-field">
                        <label for="area" class="required">Area:</label>
                        <select id="area" name="area" required>
                            <option value="">-- Select Area --</option>
                            {% for area_option in areas %}
                            <option value="{{ area_option }}">{{ area_option }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="satsang_place" class="required">Satsang Place / Centre:</label>
                        <select id="satsang_place" name="satsang_place" required>
                            <option value="">-- Select Centre --</option>
                            {% for centre_option in centres %}
                            <option value="{{ centre_option }}">{{ centre_option }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </fieldset>

            <fieldset class="form-group">
                 <div class="form-row form-row-three-items">
                    <div class="form-field">
                        <label for="first_name" class="required">First Name:</label>
                        <input type="text" id="first_name" name="first_name" required maxlength="50">
                    </div>
                    <div class="form-field">
                        <label for="last_name" class="required">Last Name:</label>
                        <input type="text" id="last_name" name="last_name" required maxlength="50">
                    </div>
                     <div class="form-field">
                         <label for="father_husband_name" class="required">Father's/Husband's Name:</label>
                        <input type="text" id="father_husband_name" name="father_husband_name" required maxlength="50">
                     </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                         <label class="required">Gender:</label>
                         <div class="radio-group">
                             <label><input type="radio" name="gender" value="Male" required> Male</label>
                             <label><input type="radio" name="gender" value="Female"> Female</label>
                         </div>
                    </div>
                    <div class="form-field">
                         <label for="dob" class="required">Date of Birth (Proof Required):</label>
                         <input type="date" id="dob" name="dob" required>
                    </div>
                    <div class="form-field">
                         <label for="age">Age (Years):</label>
                         <input type="number" id="age" name="age" min="0" max="120" readonly title="Age is calculated automatically from Date of Birth">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                         <label for="blood_group">Blood Group:</label>
                         <select id="blood_group" name="blood_group">
                             <option value="">-- Select Blood Group --</option>
                             <option value="A+">A+</option>
                             <option value="A-">A-</option>
                             <option value="B+">B+</option>
                             <option value="B-">B-</option>
                             <option value="AB+">AB+</option>
                             <option value="AB-">AB-</option>
                             <option value="O+">O+</option>
                             <option value="O-">O-</option>
                             <option value="Unknown">Unknown</option>
                         </select>
                    </div>
                    <div class="form-field">
                         <label for="aadhaar_no" class="required">Aadhaar No:</label>
                         <input type="text" id="aadhaar_no" name="aadhaar_no" pattern="\d{12}" title="Enter 12 digit Aadhaar number without spaces" required maxlength="12">
                    </div>
                    <div class="form-field">
                         <label for="mobile_no">Mobile No:</label>
                         <input type="tel" id="mobile_no" name="mobile_no" pattern="[0-9]{10}" title="Enter 10 digit mobile number" maxlength="10">
                    </div>
                </div>
                <div class="form-row">
                     <div class="form-field" style="flex-basis: 100%;">
                         <label for="photo">Passport Size Photograph:</label>
                         <input type="file" id="photo" name="photo" accept="image/png, image/jpeg, image/gif">
                         <small>(Optional. Allowed: png, jpg, jpeg, gif)</small>
                     </div>
                 </div>
             </fieldset>

             <fieldset class="form-group">
                <legend>Emergency Contact Details</legend>
                <div class="form-row">
                    <div class="form-field">
                        <label for="emergency_contact_name" class="required">Person Name:</label>
                        <input type="text" id="emergency_contact_name" name="emergency_contact_name" required maxlength="50">
                    </div>
                    <div class="form-field">
                         <label for="emergency_contact_number" class="required">Contact Number:</label>
                         <input type="tel" id="emergency_contact_number" name="emergency_contact_number" pattern="[0-9]{10,}" title="Enter valid contact number (min 10 digits)" required>
                    </div>
                    <div class="form-field">
                         <label for="emergency_contact_relation" class="required">Relation:</label>
                         <select id="emergency_contact_relation" name="emergency_contact_relation" required>
                             <option value="">-- Select Relation --</option>
                              {% for relation_option in relations %}
                             <option value="{{ relation_option }}">{{ relation_option }}</option>
                             {% endfor %}
                         </select>
                    </div>
                </div>
             </fieldset>

             <fieldset class="form-group">
                 <div class="form-row"> <div class="form-field address-field"> <label for="address" class="required">Full Address:</label>
                         <textarea id="address" name="address" rows="1" required maxlength="250"></textarea> </div>
                     <div class="form-field state-field"> <label for="state" class="required">State:</label>
                         <select id="state" name="state" required>
                             <option value="">-- Select State --</option>
                             {% for state_option in states %}
                             <option value="{{ state_option }}">{{ state_option }}</option>
                             {% endfor %}
                         </select>
                     </div>
                     <div class="form-field pincode-field"> <label for="pin_code">PIN Code:</label>
                         <input type="text" id="pin_code" name="pin_code" pattern="\d{6}" title="Enter 6 digit PIN code" maxlength="6"> </div>
                 </div>
             </fieldset>
             <fieldset class="form-group">
                 <legend>Special Needs / Requirements</legend>
                 <div class="form-row">
                     <div class="form-field">
                         <label>Physically Challenged:</label>
                         <div class="radio-group">
                             <label><input type="radio" name="physically_challenged" value="Yes"> Yes</label>
                             <label><input type="radio" name="physically_challenged" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field">
                         <label for="physically_challenged_details">If Yes, Details:</label>
                         <textarea id="physically_challenged_details" name="physically_challenged_details" rows="2"></textarea>
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-field">
                         <label>Required Help in Home Pickup:</label>
                         <div class="radio-group">
                             <label><input type="radio" name="help_pickup" value="Yes"> Yes</label>
                             <label><input type="radio" name="help_pickup" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field">
                         <label for="help_pickup_reasons">If Yes, Mention Reasons:</label>
                         <textarea id="help_pickup_reasons" name="help_pickup_reasons" rows="2"></textarea>
                     </div>
                 </div>
                 <div class="form-row four-column-row">
                     <div class="form-field four-column-field">
                         <label>Handicap:</label>
                         <div class="radio-group">
                            <label><input type="radio" name="handicap" value="Yes"> Yes</label>
                            <label><input type="radio" name="handicap" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field four-column-field">
                         <label>Stretcher Required:</label>
                         <div class="radio-group">
                            <label><input type="radio" name="stretcher" value="Yes"> Yes</label>
                            <label><input type="radio" name="stretcher" value="No" checked> No</label>
                        </div>
                     </div>
                     <div class="form-field four-column-field">
                         <label>Wheel Chair Required:</label>
                         <div class="radio-group">
                            <label><input type="radio" name="wheelchair" value="Yes"> Yes</label>
                            <label><input type="radio" name="wheelchair" value="No" checked> No</label>
                        </div>
                     </div>
                     <div class="form-field four-column-field">
                         <label>Ambulance Required:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="ambulance" value="Yes"> Yes</label>
                            <label><input type="radio" name="ambulance" value="No" checked> No</label>
                        </div>
                     </div>
                 </div>
                 <div class="form-row four-column-row">
                     <div class="form-field four-column-field">
                         <label>Operated for Pacemaker:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="pacemaker" value="Yes"> Yes</label>
                            <label><input type="radio" name="pacemaker" value="No" checked> No</label>
                        </div>
                     </div>
                      <div class="form-field four-column-field">
                         <label>Chair Required for Sitting:</label>
                         <div class="radio-group">
                            <label><input type="radio" name="chair_sitting" value="Yes"> Yes</label>
                            <label><input type="radio" name="chair_sitting" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field four-column-field">
                         <label>Special Attendant Required:</label>
                         <div class="radio-group">
                            <label><input type="radio" name="special_attendant" value="Yes"> Yes</label>
                            <label><input type="radio" name="special_attendant" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field four-column-field">
                         <label>Hearing Loss:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="hearing_loss" value="Yes"> Yes</label>
                            <label><input type="radio" name="hearing_loss" value="No" checked> No</label>
                        </div>
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-field">
                         <label>Willing to attend weekly Satsangs:</label>
                         <div class="radio-group">
                             <label><input type="radio" name="attend_satsang" value="Yes"> Yes</label>
                             <label><input type="radio" name="attend_satsang" value="No" checked> No</label>
                         </div>
                     </div>
                     <div class="form-field">
                         <label for="satsang_pickup_help">If Yes, State if help required:</label>
                         <textarea id="satsang_pickup_help" name="satsang_pickup_help" rows="2"></textarea>
                     </div>
                 </div>
                 <div class="form-row">
                     <div class="form-field" style="flex-basis: 100%;">
                        <label for="other_requests">Any Other Special Request:</label>
                        <textarea id="other_requests" name="other_requests" rows="3"></textarea>
                     </div>
                 </div>
             </fieldset>

            <button type="submit">Save and Generate Badge ID</button>
        </form>

        <div class="footer-section">
            <p>&copy; 2025 RSSB. All rights reserved.</p>
        </div>
    </div> <script>
        // Get references to the Date of Birth and Age input fields
        const dobInput = document.getElementById('dob');
        const ageInput = document.getElementById('age');

        // Function to calculate age
        function calculateAge(birthDate) {
            if (!birthDate) {
                return ''; // Return empty if no birth date
            }
            try {
                const today = new Date();
                const birthDateObj = new Date(birthDate);

                // Basic validation: check if the date is valid and not in the future
                if (isNaN(birthDateObj.getTime()) || birthDateObj > today) {
                    console.warn("Invalid or future date entered.");
                    return '';
                }

                let age = today.getFullYear() - birthDateObj.getFullYear();
                const monthDiff = today.getMonth() - birthDateObj.getMonth();

                // Adjust age if the birth month/day hasn't occurred yet this year
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDateObj.getDate())) {
                    age--;
                }

                // Return age, ensuring it's not negative (though validation above should prevent this)
                return age >= 0 ? age : 0;
            } catch (error) {
                console.error("Error calculating age:", error);
                return ''; // Return empty on error
            }
        }

        // Event listener for when the DOB input changes
        dobInput.addEventListener('change', function() {
            const dobValue = this.value; // Get the value from the DOB input
            const calculatedAge = calculateAge(dobValue); // Calculate the age
            ageInput.value = calculatedAge; // Update the Age input field
        });

        // Optional: Calculate age on initial page load if DOB might be pre-filled
        // window.addEventListener('load', function() {
        //     const initialDobValue = dobInput.value;
        //     if (initialDobValue) {
        //         const initialAge = calculateAge(initialDobValue);
        //         ageInput.value = initialAge;
        //     }
        // });
    </script>

</body>
</html>
